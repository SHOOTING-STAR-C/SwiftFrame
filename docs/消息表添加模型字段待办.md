# 消息表添加模型字段待办

## 背景
当前`ai_chat_message`表中没有记录每次消息使用的模型，无法追溯每条消息具体使用了哪个模型。

## 需求
在消息表中添加`model_id`字段，记录每条消息使用的模型ID。

## 待办事项

### 1. 数据库修改
- [ ] 在`ai_chat_message`表中添加`model_id`字段（BIGINT类型）
- [ ] 为`model_id`字段添加索引

### 2. 实体类修改
- [ ] 在`AiChatMessage.java`实体类中添加`modelId`字段
- [ ] 添加`@TableField("model_id")`注解

### 3. DTO修改
- [ ] 在`MessageDTO.java`中添加`modelId`字段
- [ ] 在`MessageDataDTO.java`中添加`modelId`字段

### 4. Service层修改
- [ ] 修改`AiChatMessageService.saveMessage()`方法，添加`modelId`参数
- [ ] 修改`AiChatService.saveUserMessage()`方法，传入`modelId`
- [ ] 修改`AiChatService.saveAssistantMessage()`方法，传入`modelId`
- [ ] 修改`AiChatService.importChatHistory()`方法，处理`modelId`

### 5. 测试
- [ ] 测试普通聊天的消息保存
- [ ] 测试匿名聊天的消息保存
- [ ] 测试聊天记录导入功能
- [ ] 验证数据库字段正确存储

## 注意事项
1. 由于会话表(`ai_chat_session`)已经包含`model_id`字段，消息表添加该字段可以支持：
   - 同一会话中切换模型的情况
   - 更精确的token统计和成本计算
   - 历史消息的模型追溯
2. 需要考虑向后兼容性，旧数据该字段为NULL
3. 在匿名聊天导入时，需要正确设置modelId

## 预期效果
- 每条消息都能追溯到使用的具体模型
- 支持会话内切换模型
- 更准确的token使用统计
- 便于后续的成本分析和优化
