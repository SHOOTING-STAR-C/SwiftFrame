<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.star.swiftSecurity.mapper.mysql.SwiftUserMapper">
    <resultMap id="BaseUserResultMap" type="com.star.swiftSecurity.entity.SwiftUserDetails">
        <id property="userId" column="user_id" javaType="java.lang.Long"/>
        <result property="username" column="username"/>
        <result property="fullName" column="full_name"/>
        <result property="password" column="password"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="enabled" column="enabled"/>
        <result property="accountNonExpired" column="account_non_expired"/>
        <result property="accountNonLocked" column="account_non_locked"/>
        <result property="credentialsNonExpired" column="credentials_non_expired"/>
        <result property="failedLoginAttempts" column="failed_login_attempts"/>
        <result property="lockUntil" column="lock_until"/>
        <result property="passwordChangedAt" column="password_changed_at"/>
        <result property="lastLoginAt" column="last_login_at"/>
        <result property="lastLoginIp" column="last_login_ip"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <resultMap id="UserResultMap" extends="BaseUserResultMap" type="com.star.swiftSecurity.entity.SwiftUserDetails">
        <collection property="userRoles" ofType="com.star.swiftSecurity.entity.SwiftUserRole"
                    select="com.star.swiftSecurity.mapper.mysql.SwiftUserRoleMapper.findByUser" column="user_id"/>
    </resultMap>

    <select id="findByUsername" resultMap="UserResultMap">
        SELECT * FROM swift_users WHERE username = #{username}
    </select>

    <select id="findBaseByUsername" resultMap="BaseUserResultMap">
        SELECT * FROM swift_users WHERE username = #{username}
    </select>

    <select id="findBaseById" resultMap="BaseUserResultMap">
        SELECT * FROM swift_users WHERE user_id = #{userId}
    </select>

    <select id="findByIdWithAuthorities" resultMap="UserResultMap">
        SELECT * FROM swift_users WHERE user_id = #{userId}
    </select>

    <update id="update">
        UPDATE swift_users
        <set>
            <if test="username != null">username=#{username},</if>
            <if test="fullName != null">full_name=#{fullName},</if>
            <if test="password != null">password=#{password},</if>
            <if test="email != null">email=#{email},</if>
            <if test="phone != null">phone=#{phone},</if>
            <if test="enabled != null">enabled=#{enabled},</if>
            <if test="accountNonExpired != null">account_non_expired=#{accountNonExpired},</if>
            <if test="accountNonLocked != null">account_non_locked=#{accountNonLocked},</if>
            <if test="credentialsNonExpired != null">credentials_non_expired=#{credentialsNonExpired},</if>
            <if test="failedLoginAttempts != null">failed_login_attempts=#{failedLoginAttempts},</if>
            <if test="lockUntil != null">lock_until=#{lockUntil},</if>
            <if test="passwordChangedAt != null">password_changed_at=#{passwordChangedAt},</if>
            <if test="lastLoginAt != null">last_login_at=#{lastLoginAt},</if>
            <if test="lastLoginIp != null">last_login_ip=#{lastLoginIp},</if>
        </set>
        WHERE user_id=#{userId}
    </update>
</mapper>
